<br />
<div align="center">
  <a href="https://github.com/Rev-1b/MirGovoritTest">
  </a>

<h3 align="center">Тех-задание для 'EffectiveMobile'</h3>

  <p align="center">
    Документация по работе приложения Личный Финансовый кошелек.
    <br />
</div>

## Как клонировать проект

Использован Pytnon 3.11

1. Клонируйте репозиторий
   ```sh
   git clone https://github.com/Rev-1b/EffectiveMobile.git
   ```
2. Активируйте виртуальное окружение
   ```sh
   source venv/bin/activate
   ```
3. Установите зависимости
   ```sh
   pip install -r requirements.txt
   ```

## О реализации

Весь функционал программы сосредоточен вокруг работы с csv-файлом, содержащим в себе транзакции, совершенные
пользователем.
Программа предоставляет консольный интерфейс для создания, чтения, фильтрации и изменения данных в csv-файле.
В проекте использована одна дополнительная библиотека:

- Pandas - Для удобной работы с csv файлом, являющимся базой данных

Программа предоставляет пользователю возможность выбрать <a href="#languages">язык интерфейса</a> перед началом работы.
Также реализована возможность быстрого добавления новых языковых пакетов.

По умолчанию, программа настроена на работу только с данными, представленными в формате:
"pk,date,type,amount,descr"

Однако, допустимые поля, ровно как и их отображение для пользователя, настраиваются в файле <a href="#handlers">
handlers.py</a>.
Там же можно настроить, какие операции сравнения значения полей будут доступны при фильтрации записей.

Так как консольный интерфейс далеко не самый интуитивно понятный, перед началом работы пользователю будет предложено
пройти небольшое обучение, которое покажет, как правильно пользоваться программой.

<a href="#validators">Валидаторы</a> не позволят пользователю "уронить" программу, на каждый некорректный ввод
пользователь будет уведомлен о неправильности вводимой команды, после чего ему будет предложено повторить попытку.

## Структура проекта

Проект состоит из 6 основных файлов:

1. <a href="#main">main.py</a> - файл, внутри которого находится бесконечный цикл, постоянно запрашивающий у
   пользователя действия.
2. <a href="#handlers">handlers.py</a> - файл, который содержит хендлеры, которые будут отрабатывать вводимые
   пользователем команды.
3. <a href="#validators">validators.py</a> - файл, который содержит валидаторы для полей базы данных.
4. <a href="#languages">languages.py</a> - файл, который содержит все языковые пакеты, а также функционал по их
   обработке.
5. <a href="#database">database.csv</a> - файл, содержащий в себе все обрабатываемые данные.
6. <a href="#utils">utils.csv</a> - файл с дополнительными миксинами и декораторами.

## <span id="main">main.py</span>

Основной файл, входная точка проекта. Для активации скрипта запускается именно этот файл.
Сразу после начала работы, позволяет пользователю выбрать язык системы (SetLanguageHandler) и пройти обучение работе
программы (WelcomeHandler).
После этого запускается бесконечный цикл, в котором вызывается объект класса ChooseCommandHandler для получения команды
от пользователя.

## <span id="handlers">handlers.py</span>

Содержит в себе все хендлеры проекта, а также коллекции, в которых можно изменять как количество и название команд, так
и поля нашей текстовой "базы данных".
Каждый хендлер представляет собой класс, наследующийся от абстрактного класса AbstractHandler.

Список всех хендлеров и их краткое описание:

1. <a href="#abstract_handler">AbstractHandler</a> - определяет общий интерфейс для всех хендлеров
2. <a href="#set_lang_handler">SetLanguageHandler</a> - устанавливает язык интерфейса
3. <a href="#welcome_handler">WelcomeHandler</a> - привествует пользователя и предлагает пройти обучение
4. <a href="#show_tutorial_handler">ShowTutorialHandler</a> - отображает пункты обучения пользователю по одному
5. <a href="#choose_command_handler">ChooseCommandHandler</a> - обрабатывает поступившие от пользователя команды
6. <a href="#show_statistic_handler">ShowStatisticHandler</a> - отображает пользователю статистику
7. <a href="#add_note_handler">AddNoteHandler</a> - обрабатывает запрос на добавление новой записи в базу
8. <a href="#find_notes_handler">FindNotesHandler</a> - выводит пользователю все записи, прошедшие фильтрацию
9. <a href="#change_notes_handler">ChangeNotesHandler</a> - изменяет прошедшие фильтрацию записи
10. <a href="#field_attrs">FieldAttrs</a> - именованный кортеж, представляющий атрибуты полей базы данных
11. <a href="#database_fields">database_fields</a> - словарь, который содержит поля и их атрибуты
12. <a href="#commands">commands</a> - словарь, который содержит имена команд для интерфейса и ссылки на их хендлеры

<hr>

### <span id="abstract_handler">class AbstractHandler</span>

Абстрактный класс, реализует абстрактный метод operate() и защищенный метод _get_command().

### def operate(self) -> None:

Абстрактный метод, который должен быть реализован у каждого хендлера. Содержит основную логику работы хендлера.

### def _get_command(self, message: str, validator: Optional[AbstractValidator] = None) -> str:

Метод для получения корректного ввода от пользователя. Перед началом работы выводит message, а затем запрашивает у
пользователя информацию, пока она не пройдет проверку в validator.validate()
Подробнее об устройстве валидаторов можно увидеть <a href="#validators">здесь</a>.
<hr>

### <span id="set_lang_handler">class SetLanguageHandler</span>

Единственный хендлер, который не зависит от выбранного языка системы. Все сообщения выводятся на английском.
Возвращает определенный языковой пакет, который далее будет использован во всех остальных хендлерах.

### def operate(self) -> dict[str, object]:

Запрашивает у пользователя код языкового пакета и возвращает его.
<hr>

### <span id="welcome_handler">class WelcomeHandler</span>

Приветствует пользователя и предлагает ему пройти обучение.
<hr>

### <span id="show_tutorial_handler">class ShowTutorialHandler</span>

Показывает пользователю обучение

### def operate(self) -> None:

Поочередно отображает шаги обучения, после каждого отображения пользователю нужно согласиться продолжить
или отказаться и выйти в главное меню.
<hr>

### <span id="choose_command_handler">class ChooseCommandHandler</span>

Главный хендлер программы. Определяет, какой хендлер запускать следующим.

### def operate(self) -> Type[Handler]:

Запрашивает у пользователя псевдоним хендлера, который необходимо использовать и возвращает ссылку на этот хендлер.
Псевдонимы и ссылки можно настроить <a href="#commands">здесь</a>.
<hr>

### <span id="show_statistic_handler">class ShowStatisticHandler</span>

Отображает статистику по базе данных.

### def operate(self) -> None:

Отображает баланс, доходы и расходы пользователя. Далее в бесконечном цикле пользователю будет дана возможность выбрать,
по какому критерию отобразить все транзакции: все доходы или расходы.
Выйти из цикла можно, написав команду 'exit'.
<hr>

### <span id="add_note_handler">class AddNoteHandler</span>

Добавляет новую запись в базу данных.

### def operate(self) -> None:

Проходит через все поля базы данных, указанных <a href="#database_fields">здесь</a>, и запрашивает у пользователя
значение
для каждого из них. После отображает пользователю получившуюся запись и добавляет ее в базу.
<hr>

### <span id="find_notes_handler">class FindNotesHandler</span>

Отображает все записи из базы, прошедшие фильтрацию

### def operate(self) -> tuple[pd.DataFrame, str]:

Создает запрос к базе данных на основе выбора пользователя.
После формирования каждого запроса пользователю будут показаны все отфильтрованные записи из базы данных.
Далее пользователю предлагается создать дополнительный запрос к уже отфильтрованным записям.

Функция возвращает объект базы данных и сгенерированный запрос, необходимые для работы ChangeNotesHandler.

### def _get_query(self) -> str:

Запрашивает у пользователя 3 параметра:

1) Поле, по которому будет происходить фильтрация
2) Логическая операция, выполняемая над значениями полей
3) Значение, с которым будут сравниваться значения полей

После этого функция возвращает завершенную строку запроса
<hr>

### <span id="change_notes_handler">class ChangeNotesHandler</span>

Изменяет все записи, прошедшие фильтрацию. Расширяет класс FindNotesHandler.

### def operate(self) -> tuple[pd.DataFrame, str]:

Вызывает родительский метод operate(), который возвращает датафрейм и готовую строку запроса. Это позволяет не открывать
файл базы данных, а работать со старым.

Функция запросит у пользователя, какие поля необходимо изменить, потом предоставит возможность ввести новые значения для
выбранных полей и в итоге перезапишет базу данных.

### def _get_fields_to_change(self) -> list[str]:

Предлагает пользователю выбрать поле для изменения.
После этого она предложит ввести еще несколько полей.

После этого функция возвращает список со всеми полями для изменения.

### def _get_new_field_values(self, fields_to_change: list[str]) -> dict[str, str | int]:

Для каждого поля в fields_to_change запросит новое значение. Получившаяся пара {поле: новое значение поля} будет
добавлена
в результирующий словарь.
<hr>

### <span id="field_attrs">FieldAttrs</span>

Класс, наследующийся от NamedTuple.

Поля класса (с пояснениями):

    Кортеж со всеми логическими операциями, доступными над полем
    operations: tuple[str]

    Ссылка на класс-валидатор, который срабатывает при
    вводе значения поля
    validator_class: Type[Validator]

    Ключ, по которому можно получить значение для инициализации
    объекта валидатора
    validator_arg_code: str

    Ключ, по которому можно получить сообщение для отображения 
    при вводе значения
    input_message: str

    Форма для составления запроса
    query_form: str

<hr>

### <span id="database_fields">Поля базы данных</span>

Словарь, в котором настраиваются поля базы данных, их псевдонимы и атрибуты.
Ключами словаря выступают названия полей, а значениями объекты FieldAttrs.

### Пример поля с атрибутами

    'date': FieldAttrs(
        operations=('==', '>', '>=', '<', '<='),
        validator_class=RegExValidator,
        validator_arg_code='date_regex',
        input_message='date_input',
        query_form='{main_arg}{operation}"{sub_arg}"'

При добавлении новых полей в базу, необходимо придерживаться этого формата. При соблюдении одинаковой структуры,
достаточно менять только этот словарь.
<hr>

### <span id="commands">Команды</span>
Словарь, в котором содержатся псевдонимы всех команд и ссылки на классы хендлеров.

    'show': ShowStatisticHandler,
    'add': AddNoteHandler,
    'find': FindNotesHandler,
    'change': ChangeNotesHandler,
<hr>

## <span id="validators">validators.py</span>
В этом файле содержатся валидаторы, которые применяются при вводе значения поля. Для каждого поля выбирается 
свой валидатор, который указывается в database_fields.

Каждый валидатор наследуется от AbstractValidator. Все валидаторы обязаны иметь метод .validate(user_entered), который
принимает в виде аргумента введенную пользователем информацию, проверяет ее на валидность и возвращает булево значение.


## <span id="languages">languages.py</span>

В этом файле содержатся все языковые пакеты в виде словаря, а также коллекция 'registered_languages', которой задается
список языков, доступных пользователю.
Для добавления нового языкового пакета, необходимо:

1. Скопировать структуру готового языкового пакета
2. Перевести все строки-значения словаря, не трогая знаки '\n' и все фигурные скобки со значениями внутри
3. Зарегистрировать новый языковой пакет в коллекции 'registered_languages', где ключом будет языковой код, отображаемый
   пользователю, а значением - ссылка на словарь, являющийся новым языковым пакетом.

## <span id="database">database.py</span>

Файл в формате CSV, в котором разделителем должна выступать ',', а названиями столбцов должны быть:

"pk,date,type,amount,descr"

Ожидаемые названия столбцов можно изменить в коллекциях '<a href="#database_fields">database_fields</a>' в файле 
<a href="#handlers">handlers.py</a>. 

## <span id="utils">utils.py</span>
В этом файле содержатся классы миксинов и декораторы.

Список всех миксинов и декораторов:
1. <a href="#pretty_print">PrettyPrintMixin</a> - для красивого отображения записей базы 
2. <a href="#translate_dict">translate_dict</a> - для вывода псевдонимов полей
<hr>

### <span id="pretty_print">PrettyPrintMixin</span>
Предоставляет дополнительную функцию pprint() для всех дочерних классов.
### def pprint(obj, **kwargs):
Функция передается в качестве аргумента функции df.apply().
Красиво отображает записи из базы данных, разделяя их линиями
<hr>

### <span id="translate_dict">translate_dict</span>
Функция предназначена для использования в качестве декоратора.
Для некоторых полей значения, хранящиеся в базе данных, имеют псевдонимы, более удобные для пользователя.
Эта функция обнаруживает ввод таких полей и выполняет двойной перевод.
Сначала значение из базы данных заменяется его псевдонимом.
После того, как пользователь выбирает псевдоним, происходит обратный перевод и структура базы данных не меняется.
<hr>


